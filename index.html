<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<title>Site stub</title>
	<meta name="description" content="">
	<meta name="author" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="shortcut icon" href="img/favicon.png">

	<link rel="stylesheet" href="css/normalize.css">
	<link rel="stylesheet" href="css/main.css">
</head>
<body>
	<div class="wrap-page">
		<header>
			<img src="img/logo-brand.png" class="brand-logo" />

			<span class="brand-title">
				NaSheste
				<span class="loc-options">
					<a href="#" class="loc-opt-current">Лос-Анджелес</a>
					<div class="loc-opt-dropdown" style="display: none;">
						<a href="#" data-loc-value="los-angeles" style="display: none;">Лос-Анджелес</a>
						<a href="#" data-loc-value="st-tropez">Сен-Тропе</a>
						<a href="#" data-loc-value="miami">Майами</a>
						<a href="#" data-loc-value="volzhsky">Волжский</a>
						<a href="#" data-loc-value="ivanovo">Иваново</a>
					</div>
				</span>
			</span>

			<nav>
				<a href="#" class="nav-item">Рекомендации</a>
				<span class="nav-item nav-current">Студии</span>
				<a href="#" class="nav-item">Занятия</a>
			</nav>

			<div class="login-corner">
				<a href="#">Войти</a> / <a href="#">Зарегистрироваться</a>
			</div>

			<div class="user-corner" style="display: none;">
				<img src="http://placehold.jp/100x100.png" class="avatar-corner" />
				<span class="username-corner">Shmonka1997</span>
			</div>
		</header>

		<div class="map-top">
			<div class="gmap_canvas">
				<img id="gmap-spinner" src="img/spinner-large.svg" />
				<iframe id="gmap_canvas" data-src="https://maps.google.com/maps?q=los%20angeles&t=&z=11&ie=UTF8&iwloc=&output=embed" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" importance="low"></iframe>
			</div>
		</div>

		<main>
			<div class="postings-filter">
				<div class="search-query-container">
					<input id="search-query" placeholder="Поиск-хуёиск..." autofocus />
	                <button class="search-query-showfilters" id="show-filters">
	                	<img src="img/filter.svg" />
	                </button>
	                <button class="search-query-submit" type="submit">
	                	<img src="img/search.svg" />
	                </button>
		        </div>

		        <div id="postings-filters-form" style="display: none;">
					<div class="filter-location">
						<span class="caption">Метро:</span>
						<a href="#">Пердановская</a>
						<a href="#">Дристановская</a>
						<a href="#" class="current">Поносковский проспект</a>
						<a href="#">Малые обоссыши</a>
					</div>
					<div class="filter-tags">
						<span class="caption">Виды занятий:</span>
						<div class="filter-tags-container">
							<a href="#" class="chosen">пидор</a>
							<a href="#" class="chosen">пизда</a>
							<a href="#">туз</a>
							<a href="#">малафья</a>
							<a href="#" class="chosen">гомик</a>
							<a href="#">мудила</a>
							<a href="#">пилотка</a>
							<a href="#" class="chosen">манда</a>
							<a href="#">анус</a>
							<a href="#">вагина</a>
							<a href="#">путана</a>
							<a href="#">пидрила</a>
							<a href="#">шалава</a>
							<a href="#">хуила</a>
							<a href="#">мошонка</a>
							<a href="#">елда</a>
						</div>
					</div>
					<div class="filter-location">
						<span class="caption">Город:</span>
						<a href="#" class="current">Москва</a>
						<a href="#">Чернобыль</a>
						<a href="#">Могилев</a>
					</div>
				</div>
			</div>

			<div class="postings-count">
				Найдено <span>798</span> студий
			</div>

			<div id="postings" class="postings-container">
				<div id="t_posting" class="posting" style="display: none;">
					<div class="p-thumbnail">
						<img src="content/listpic10.jpg" />
					</div>
					<div class="p-body">
						<div class="p-details">
							<h3 class="p-title">Братишка</h3>

							<div class="p-tags">
								<p>
									<!-- Tags in <a> elements -->
								</p>
							</div>

							<div class="p-row">
								<strong>Расположение:</strong>
								<span class="p-location">м. Бражская</span>
							</div>

							<div class="p-description">
								<p>Я на лошади. Ты на белом коне, и я на белом коне. А потом салют... в нашу честь. Салют в нашу честь.</p>
							</div>
						</div>

						<div class="p-link">
							<a href="#">Подробнее &rarr;</a>
						</div>
					</div>
				</div>
			</div> <!-- #postings -->

			<div id="postings-more">
				<a href="#">Следующие 20</a>
			</div>
		</main>
	</div>

	<footer>
		Пидо&reg;, пизда, &trade;, гоми&copy;, мудила
	</footer>

	<script>
		window.addEventListener('load', () => {
			const gMapCanvas = document.getElementById('gmap_canvas');

			gMapCanvas.src = gMapCanvas.dataset.src;

			gMapCanvas.onload = () => {
				document.getElementById('gmap-spinner').style.display = 'none';
			};

			const postings = document.getElementById('postings');

			let p = document.getElementById('t_posting');

			function loadData() {
				fetch("/dummy-data/los-angeles.json").then(response => {
					return response.json();
				}).then(data => {
					data.forEach(x => {
						let q = p.cloneNode(true);

						q.style.display = null;

						q.querySelector('.p-title').textContent = x.title;
						q.querySelector('.p-thumbnail img').src = x.imgUrl;
						q.querySelector('.p-location').textContent = x.location;
						
						let desc = q.querySelector('.p-description');
						desc.innerHTML = "";

						x.description.forEach(line => {
							let descPart = document.createElement('p');
							descPart.textContent = line;
							desc.appendChild(descPart);
						});

						let tags = q.querySelector('.p-tags p');
					
						x.tags.forEach(tag => {
							let tagEl = document.createElement('a');
							tagEl.textContent = tag;
							tagEl.href = '#';
							tags.appendChild(tagEl);

							tags.appendChild(document.createTextNode(" "));
						});

						postings.appendChild(q);
					})
				}).catch(error => {
					console.log(error);
				});
			}

			loadData();

			document.querySelector('#postings-more').onclick = e => {
				e.preventDefault();
				loadData();
			};

			const locOptions = document.querySelector('.loc-options');
			const locCurrent = locOptions.querySelector('.loc-opt-current');
			const locDropdown = locOptions.querySelector('.loc-opt-dropdown')
			const locVariants = Array.from(locOptions.querySelectorAll('a'));

			locOptions.querySelector('.loc-opt-current').onclick = e => {
				e.preventDefault();
			};

			locOptions.querySelector('.loc-opt-current').onfocus = e => {
				locDropdown.style.display = null;
			};

			locVariants.forEach(el => {
				if(el.dataset.locValue) {
					el.onclick = e => {
						e.preventDefault();

						if(!locOptions.style.minWidth) {
							locOptions.style.minWidth = e.target.clientWidth + 'px';
						}

						locCurrent.textContent = el.textContent;

						el.style.display = 'none';

						locVariants.forEach(otherEl => {
							otherEl.style.display = (el.dataset.locValue === otherEl.dataset.locValue) ? 'none' : null;
						});
					}
				}

				el.onblur = e => {
					if(!e.relatedTarget || e.relatedTarget.parentNode !== locOptions.querySelector('.loc-opt-dropdown')) {
						locDropdown.style.display = 'none';
					}
				};

				el.onkeydown = e => {
					if(e.key === 'Escape') {
						e.target.blur();
					}
				};
			});

			/**
			 *	1. При выборе города в выпадающем меню загружать и показывать соответствующий JSON (из папки /dummy-data)
			 *		(перед вставкой новых дивов удалить старые) (а теперь не скрыть, а именно удалить)
			 *	2. Показать число записей в .postings-count
			 *	3. Нарисовать маленькую форму входа (логин, пароль, галочка) и показывать по клику на ссылку "Войти"
			 *		(прям под ссылкой в углу, примерно по аналогии со списком городов)
			 *	4. Валидировать эту форму (неважно, по каким признакам);
			 *		в случае успеха -- скрыть .login-corner и показать .user-corner (типа, залогинились)
			 */
		});
	</script>
</body>
</html>
